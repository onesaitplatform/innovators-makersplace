<!DOCTYPE html>
<html lang="en">

<head>
	<title>Market Place IoT</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!--===============================================================================================-	
	<link rel="icon" type="image/png" href="images/icons/favicon.ico"/>->
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/Linearicons-Free-v1.0.0/icon-font.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
	<!--===============================================================================================	
	<link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">-->
	<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<!--===============================================================================================-->

</head>

<body>

	<div class="limiter">
		<nav class="navbar navbar-expand-lg navbar-light bg-light navbar-fixed-top" style="height: 80px; background-color: #cffcc7 !important;">
			<a class="navbar-brand" href="main.html">MARKET PLACE IOT MAKERS 3D</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown"
				aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse pull-right" id="navbarNavDropdown">
				<ul class="navbar-nav ">
					<li class="nav-item">
						<a class="nav-link" href="create.html"><span class="lnr lnr-plus-circle"></span> Crear</a>
					</li>
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown"
							aria-haspopup="true" aria-expanded="false">
							<span class="lnr lnr-user"></span> rtvachet
						</a>
						<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">

							<a class="dropdown-item disabled" href="#">Información personal</a>
							<a class="dropdown-item" href="index.html">Cerrar sesión</a>
						</div>
					</li>
				</ul>
			</div>
			<div id="spinnermain" class="spinner-grow text-dark" style="display:none;height: 20px; width:  20px;" role="status"> 
				<span class="sr-only">Loading</span> 
			</div> 
		</nav>
		<div class="container">
			<div id="market-elements" class="row">
				<div class="col-12">
					<div class="card" style="margin-top: 50px;"  >

						<div class="card-body">
							<h5 class="card-title" style="margin-top: 50px;" >CREANDO ALGO NUEVO</h5>
							<div class="row justify-content-md-center">
								<div class="col-12">
									<div id="creacionCorrecta" style="display:none" class="alert alert-success"
										role="alert">
										<h5>¡¡ Se ha creado correctamente !!</h5>
									</div>
									<div id="creacionFallida" style="display:none" class="alert alert-danger"
										role="alert">
										<h5>Se ha producido un error al crear, intento de nuevo y si el problema
											persiste intentelo pasado unos minutos.</h5>
									</div>
									<form class="validate-form " enctype="multipart/form-data" id="formuploadajax"
										method="post">

										<div class="wrap-input100 validate-input m-b-26"
											data-validate="Usuario es necesario">
											<span>Nombre</span>
											<input type="text" class="form-control " id="name"
												placeholder="Introduzca Nombre" \>
										</div>
										<div class="wrap-input100 validate-input m-b-26"
											data-validate="Descripción es necesaria">
											<span>Descripción</span>
											<textarea class="form-control" id="description" rows="2"
												placeholder="Introduzca Descripción"></textarea>
										</div>
										<div class="wrap-input100 validate-input m-b-26"
											data-validate="Resumen es necesario">
											<span>Resumen</span>
											<textarea class="form-control" id="summary" rows="4"></textarea>
										</div>

										<label>Imagen</label>
										<div id="alertimagen" class="alert alert-danger " style="display:none;"
											role="alert">
											Es necesaria imagen
										</div>
										<div class="custom-file  ">
											<input type="file" class="custom-file-input" id="image1" name="filename">
											<label id="labelimage" class="custom-file-label" for="customFile">Selecciona una imagen</label>
										</div>

										<label>Plano</label>
										<div id="alertplano" class="alert alert-danger " style="display:none;"
											role="alert">
											Es necesario plano
										</div>
										<div class="custom-file">
											<input type="file" class="custom-file-input" id="asset" name="filename">
											<label id="labelfichero" class="custom-file-label"
												for="customFile">Selecciona el fichero con el plano</label>
										</div>


									</form>
								</div>
							</div>
							<div class="row"></div>
							<input id="createbutton" class="login100-form-btn pull-right" style="margin-top: 20px;"
								type="button" value="Crear">
						</div>


					</div>
				</div>
			</div>


		</div>
	</div>
	</div>

	<!--===============================================================================================-->
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
	<!--===============================================================================================-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/select2/select2.min.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/daterangepicker/moment.min.js"></script>
	<script src="vendor/daterangepicker/daterangepicker.js"></script>
	<!--===============================================================================================-->
	<script src="vendor/countdowntime/countdowntime.js"></script>
	<!--===============================================================================================-->
	<script src="js/main.js"></script>


	<script>
		$("#image1").on("change", function () {
			var fileName = $(this).val().split("\\").pop();
			$(this).siblings("  .custom-file-label").addClass("selected").html(fileName);
		});
		$("#asset").on("change", function () {
			var fileName = $(this).val().split("\\").pop();
			$(this).siblings("  .custom-file-label").addClass("selected").html(fileName);
		});


		$('#createbutton').on('click', function () {

			var check = true;
			$('#name').parent().removeClass('alert-validate');
			$('#description').parent().removeClass('alert-validate');
			$('#summary').parent().removeClass('alert-validate');
			$('#labelimage').parent().removeClass('alert-validate');
			$('#labelfichero').parent().removeClass('alert-validate');
			$('#alertimagen').hide();
			$('#alertplano').hide();
			$('#creacionFallida').hide();
			$('#creacionCorrecta').hide();

			var name = $('#name').val();
			var desc = $('#description').val();
			var sumary = $('#summary').val();
			var file = $("#labelimage").text();
			var fich = $("#labelfichero").text();

			if (name.trim().length == 0) {
				$('#name').parent().addClass('alert-validate');
				check = false;
			}
			if (desc.trim().length == 0) {
				$('#description').parent().addClass('alert-validate');
				check = false;
			}
			if (sumary.trim().length == 0) {
				$('#summary').parent().addClass('alert-validate');
				check = false;
			}
			if (file.trim().length == 0 || file == "Selecciona una imagen") {
				$('#alertimagen').show();
				check = false;
			}
			if (fich.trim().length == 0 || fich == "Selecciona el fichero con el plano") {
				$('#alertplano').show();
				check = false;
			}



			if (check) {
				sendForm()
			}
		});

		function sendForm() {
	        $('#spinnermain').show();
			var form = new FormData();
			form.append("name", $('#name').val());
			form.append("description", $('#description').val());
			form.append("summary", $('#summary').val());
			form.append("asset", $('#asset')[0].files[0], $("#labelfichero").text());
			form.append("image1", $('#image1')[0].files[0], $("#labelimage").text());
			form.append("user", "rtvachet");
			var settings = {
				"url": "https://lab.onesaitplatform.com/api-manager/server/api/v1/Market3D_asset/insert/",
				"method": "POST",
				"timeout": 0,
				"headers": {
					"X-OP-APIKey": "b2fd5ceda7154eecb401886f461a6f0a"
				},
				"processData": false,
				"mimeType": "multipart/form-data",
				"contentType": false,
				"data": form
			};

			$.ajax(settings).fail(function (response) {			
				$('#creacionFallida').show();
				console.log(response);
				$('#spinnermain').hide();
			}).done(function (response) {
				$('#creacionCorrecta').show();
				console.log(response);
				$('#spinnermain').hide();
				setTimeout(() => {
					document.location.href = "main.html";
				}, 4000);
			});
		}
	</script>

</body>

</html>